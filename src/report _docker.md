## Part 1. Готовый докер
В качестве конечной цели своей небольшой практики вы сразу выбрали написание докер образа для собственного веб сервера, а потому в начале вам нужно разобраться с уже готовым докер образом для сервера.
Ваш выбор пал на довольно простой nginx.
== Задание ==

![скачивание образа nginx, проверка, запуск](image/12.jpg)

Взять официальный докер образ с nginx и выкачать его при помощи docker pull


Проверить наличие докер образа через docker images


Запустить докер образ через docker run -d [image_id|repository]


Проверить, что образ запустился через docker ps

![проверка запущенного образа командой docker ps](image/13.jpg)

Посмотреть информацию о контейнере через docker inspect [container_id|container_name]


По выводу команды определить и поместить в отчёт размер контейнера, список замапленных портов и ip контейнера
![информация о контейнере](image/14.jpg)

![информация о контейнере](image/15.jpg)

Остановить докер образ через docker stop [container_id|container_name]


Проверить, что образ остановился через docker ps

![остановка контейнера и проверка остановки](image/16.jpg)

Запустить докер с портами 80 и 443 в контейнере, замапленными на такие же порты на локальной машине, через команду run

![запруск контейнера с указанными портами, проверка localhost:80](image/17.jpg)

Проверить, что в браузере по адресу localhost:80 доступна стартовая страница nginx

Перезапустить докер контейнер через docker restart [container_id|container_name]

Проверить любым способом, что контейнер запустился

![проверка запуска контейнера в терминале](image/18.jpg)

![проверка запуска контейнера в браузере](image/19.jpg)

## Part 2. Операции с контейнером

Докер образ и контейнер готовы. Теперь можно покопаться в конфигурации nginx и отобразить статус страницы.
== Задание ==

** создание нового контейнера с именем ngnix2 
![создание нового контейнера с именем ngnix2](image/20.jpg)

### 2.1  Прочитать конфигурационный файл nginx.conf внутри докер контейнера через команду exec
![конфигурационный файл nginx.conf](image/21.jpg)
### 2.2  Создать на локальной машине файл nginx.conf
![локальной машине файл nginx.conf](image/22.jpg)
### 2.3  Настроить в нем по пути /status отдачу страницы статуса сервера nginx
![Настроить в нем по пути /status отдачу страницы](image/2X.jpg)
### 2.4  Скопировать созданный файл nginx.conf внутрь докер образа через команду docker cp
![nginx.conf внутрь докерa](image/24.jpg)
### 2.5  Перезапустить nginx внутри докер образа через команду exec
![ерезапустить nginx внутри докер](image/25.jpg)
### 2.6  Проверить, что по адресу localhost:80/status отдается страничка со статусом сервера nginx
![адресу localhost:80/status отдается страничка](image/219.jpg)
### 2.7  Экспортировать контейнер в файл container.tar через команду export
![контейнер в файл container.tar](image/27.jpg)
### 2.8  Остановить контейнер
![Остановить контейнер](image/28.jpg)
### 2.9  Удалить образ через docker rmi [image_id|repository], не удаляя перед этим контейнеры
![Удалить образ через docker rmi](image/29.jpg)
### 2.10  Удалить остановленный контейнер
![Удалить остановленный контейнер](image/210.jpg)
### 2.11  Импортировать контейнер обратно через команду import
![Импортировать контейнер](image/211.jpg)
### 2.12  Запустить импортированный контейнер
![Запустить импортированный контейнер](image/212.jpg)
### 2.13  Проверить, что по адресу localhost:80/status отдается страничка со статусом сервера nginx
![по адресу localhost:80/status отдается страничка ](image/219.jpg)



## Part 3. Мини веб-сервер
### 3.1 Написать мини сервер на C и FastCgi, который будет возвращать простейшую страничку с надписью Hello World!
![](image/3.1.jpg)
### 3.2 Написать свой nginx.conf, который будет проксировать все запросы с 81 порта на 127.0.0.1:8080
![](image/3.2.jpg)
### 3.3 Запустить написанный мини сервер через spawn-fcgi на порту 8080

Последоватлеьность действий:
``` brew
docker pull nginx
docker images
docker run -d -p 81:81 [IMAGE_ID]
docker ps
```
![](image/3.3.jpg)
``` brew
docker cp nginx.conf [CONTAINER ID]:/etc/nginx/
docker cp server.c [CONTAINER ID]:/home/
docker exec -it [CONTAINER ID] bash     // чтобы подключиься к контейнеру
```
![](image/3.4.jpg)
``` brew
apt-get update
apt-get install gcc
apt-get install spawn-fcgi
apt-get install libfcgi-dev
gcc *.c -lfcgi
spawn-fcgi -p 8080 /image/a.out
nginx -s reload
```
![](image/3.5.jpg)

### 3.4 Проверить, что в браузере по localhost:81 отдается написанная вами страничка
``` brew
curl localhost:81
```
![](image/3.6.jpg)
![](image/3.7.jpg)

## Part 4. Свой докер
### 4.1 Написать свой докер образ, который:

1) собирает исходники мини сервера на FastCgi из Части 3

2) запускает его на 8080 порту

3) копирует внутрь образа написанный /image/nginx/nginx.conf

4) запускает nginx.


![](image/4.1.jpg)
![](image/4.2.jpg)

### 4.2 Собрать написанный докер образ через docker build при этом указав имя и тег

![](image/4.3.jpg)
![](image/4.4.jpg)

### 4.3 Проверить через docker images, что все собралось корректно

![](image/4.5.jpg)

### 4.3 Запустить собранный докер образ с маппингом 81 порта на 80 на локальной машине и маппингом папки /image/nginx внутрь контейнера по адресу, где лежат конфигурационные файлы nginx'а (см. Часть 2)
![](image/4.6.jpg)

### 4.4 Проверить, что по localhost:80 доступна страничка написанного мини сервера
![](image/4.7.jpg)

### 4.5 Дописать в /nginx/nginx.conf проксирование странички /status, по которой надо отдавать статус сервера nginx
![](image/4.8.jpg)

### 4.6 Перезапустить докер образ
![](image/4.9.jpg)

### 4.7 Проверка, что теперь по *localhost:80/status* отдается страничка со статусом **nginx**
![](image/4.10.jpg)

## Part 5. Dockle  

### 5.1 Установка утилиты dockle

![](image/5.0.jpg)

### 5.2 Просканировать образ из предыдущего задания через dockle [image_id|repository]
``` brew
команда dockle -i CIS-DI-0010 r:r
```
![](image/5.1.jpg)
![](image/5.2.jpg)

### 5.3 Исправить образ так, чтобы при проверке через dockle не было ошибок и предупреждений
![](image/5.3.jpg)
![](image/5.4.jpg)


## Part 6. Базовый Docker Compose
### 6.1 Написать файл docker-compose.yml, с помощью которого:
1) Поднять докер контейнер из Части 5 (он должен работать в локальной сети, т.е. не нужно использовать инструкцию EXPOSE и мапить порты на локальную машину)
2) Поднять докер контейнер с nginx, который будет проксировать все запросы с 8080 порта на 81 порт первого контейнера

![](image/6.10.jpg)

### 6.2 Замапить 8080 порт второго контейнера на 80 порт локальной машины
![](image/6.7.jpg)
![](image/6.8.jpg)
![](image/6.9.jpg)


### 6.3 Собрать и запустить проект с помощью команд docker-compose build и docker-compose up
![](image/6.11.jpg)
![](image/6.12.jpg)

### 6.4 Проверить, что в браузере по localhost:80 отдается написанная вами страничка, как и ранее

![](image/6.13.jpg)
